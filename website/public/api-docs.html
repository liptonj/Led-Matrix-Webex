<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation - LED Matrix Webex Display</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>üìö API Documentation</h1>
            <p class="tagline">Integrate with the LED Matrix Display</p>
            <div class="header-actions">
                <button class="theme-toggle" type="button" aria-pressed="false">Theme: Light</button>
            </div>
        </div>
    </header>

    <main class="container">
        <section>
            <h2>Device Web API</h2>
            <p>The LED Matrix Display exposes a local web API for configuration and status monitoring. All endpoints are accessible at <code>http://&lt;device-ip&gt;/api/</code> or <code>http://led-matrix.local/api/</code></p>
        </section>

        <section>
            <h3>GET /api/status</h3>
            <p>Get current device status including presence, WiFi, and system information.</p>
            <div class="code-block">
                <code>
curl http://led-matrix.local/api/status
                </code>
            </div>
            <p><strong>Response:</strong></p>
            <div class="code-block">
                <code>
{<br>
  "presence": "active",<br>
  "wifi": {<br>
    "ssid": "MyNetwork",<br>
    "rssi": -45,<br>
    "ip": "192.168.1.100"<br>
  },<br>
  "system": {<br>
    "version": "1.0.5",<br>
    "uptime": 3600,<br>
    "free_heap": 123456<br>
  }<br>
}
                </code>
            </div>
        </section>

        <section>
            <h3>POST /api/presence</h3>
            <p>Manually set presence status (overrides Webex for 5 minutes).</p>
            <div class="code-block">
                <code>
curl -X POST http://led-matrix.local/api/presence \<br>
  -H "Content-Type: application/json" \<br>
  -d '{"status": "meeting"}'
                </code>
            </div>
            <p><strong>Valid status values:</strong> active, meeting, dnd, away, inactive</p>
        </section>

        <section>
            <h3>GET /api/config</h3>
            <p>Get device configuration (non-sensitive fields only).</p>
            <div class="code-block">
                <code>
curl http://led-matrix.local/api/config
                </code>
            </div>
        </section>

        <section>
            <h3>POST /api/config</h3>
            <p>Update device configuration.</p>
            <div class="code-block">
                <code>
curl -X POST http://led-matrix.local/api/config \<br>
  -H "Content-Type: application/json" \<br>
  -d '{"brightness": 50, "mode": "webex"}'
                </code>
            </div>
        </section>

        <section>
            <h3>POST /api/restart</h3>
            <p>Restart the device.</p>
            <div class="code-block">
                <code>
curl -X POST http://led-matrix.local/api/restart
                </code>
            </div>
        </section>

        <section>
            <h2>Bridge Server API</h2>
            <p>When using the optional Node.js bridge server, it exposes WebSocket and REST APIs for managing multiple displays.</p>

            <h3>WebSocket Connection</h3>
            <p>Displays connect to <code>ws://&lt;bridge-server&gt;:8080</code> for real-time presence updates.</p>
            <div class="code-block">
                <code>
// Device registration<br>
{<br>
  "type": "register",<br>
  "deviceId": "led-matrix-001",<br>
  "userId": "user@example.com"<br>
}<br>
<br>
// Presence update from server<br>
{<br>
  "type": "presence",<br>
  "status": "active",<br>
  "timestamp": 1234567890<br>
}
                </code>
            </div>
        </section>

        <section>
            <h3>Bridge REST API</h3>
            <p>Management API for the bridge server.</p>

            <h4>GET /api/devices</h4>
            <p>List all registered devices.</p>

            <h4>GET /api/devices/:id</h4>
            <p>Get specific device status.</p>

            <h4>POST /api/devices/:id/presence</h4>
            <p>Set presence for a specific device.</p>
        </section>

        <section>
            <h2>Home Assistant Integration</h2>
            <p>The Home Assistant add-on provides entity integration:</p>
            <ul>
                <li><code>sensor.led_matrix_presence</code> - Current presence status</li>
                <li><code>sensor.led_matrix_uptime</code> - Device uptime</li>
                <li><code>button.led_matrix_restart</code> - Restart device</li>
                <li><code>number.led_matrix_brightness</code> - Adjust brightness</li>
            </ul>
        </section>

        <section>
            <h2>mDNS Discovery</h2>
            <p>Devices advertise themselves via mDNS as <code>_ledmatrix._tcp.local</code> with the following properties:</p>
            <ul>
                <li><code>version</code> - Firmware version</li>
                <li><code>mode</code> - Operation mode (webex/bridge/meraki)</li>
                <li><code>chip</code> - ESP32 or ESP32-S3</li>
            </ul>
        </section>

        <section>
            <h2>Firmware Version API</h2>
            <p>Check for firmware updates programmatically:</p>
            <h3>GET /updates/manifest.json</h3>
            <p>Returns list of available firmware versions.</p>
            <div class="code-block">
                <code>
curl https://display.5ls.us/updates/manifest.json
                </code>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p><a href="index.html">‚Üê Back to Home</a></p>
            <p>Open source project - MIT License</p>
        </div>
    </footer>

    <script src="js/main.js"></script>
</body>
</html>
