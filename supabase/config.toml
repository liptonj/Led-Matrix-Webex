# Supabase Configuration for LED Matrix Webex Display
# See: https://supabase.com/docs/reference/cli/config

[api]
enabled = true
port = 54321
schemas = ["public", "display"]
extra_search_path = ["public", "display", "extensions"]
max_rows = 1000

[db]
port = 54322
shadow_port = 54320
major_version = 15

[studio]
enabled = true
port = 54323
api_url = "http://localhost"

[inbucket]
enabled = true
port = 54324
smtp_port = 54325
pop3_port = 54326

[storage]
enabled = true
file_size_limit = "50MiB"

[auth]
enabled = true
site_url = "http://localhost:3000"
additional_redirect_urls = ["https://display.5ls.us"]
jwt_expiry = 3600
enable_signup = false
enable_anonymous_sign_ins = false
signing_keys_path = "./signing_key.json"

[auth.email]
enable_signup = false
double_confirm_changes = true
enable_confirmations = false

# Auth hook to set JWT claims (is_admin, disabled)
# This hook runs on login and token refresh to inject custom claims into JWTs:
# - app_metadata.is_admin: Whether user is an admin (from admin_users table)
# - app_metadata.disabled: Whether user account is disabled (from user_profiles table)
#
# Configuration:
# - For production: Use scripts/configure-auth-hook.ts or configure via Dashboard
# - For local dev: Set enabled = true and ensure Edge Function is running
#
# Hook endpoint: https://PROJECT_ID.supabase.co/functions/v1/auth-hook-set-claims
# Secret: DEVICE_JWT_SECRET (must match project secrets)
#
# See docs/AUTH_HOOK_CONFIGURATION.md for detailed setup instructions
[auth.hook.custom_access_token]
enabled = false
# uri = "http://localhost:54321/functions/v1/auth-hook-set-claims"  # Uncomment for local dev
# secrets = ["DEVICE_JWT_SECRET"]  # Uncomment for local dev

# Edge Function auth settings
[functions.ack-command]
verify_jwt = false

[functions.admin-create-user]
verify_jwt = false

[functions.admin-delete-user]
verify_jwt = false

[functions.admin-update-user]
verify_jwt = false

[functions.admin-upsert-oauth-client]
verify_jwt = false

[functions.auth-hook-set-claims]
verify_jwt = false

[functions.broadcast-device-log]
verify_jwt = false

[functions.cleanup-logs]
verify_jwt = false

[functions.device-auth]
verify_jwt = false

[functions.exchange-pairing-code]
verify_jwt = false

[functions.get-firmware]
verify_jwt = false

[functions.get-manifest]
verify_jwt = false

[functions.insert-command]
verify_jwt = false

[functions.insert-device-log]
verify_jwt = false

[functions.poll-commands]
verify_jwt = false

[functions.post-device-state]
verify_jwt = false

[functions.provision-device]
verify_jwt = false

# @deprecated - This Edge Function is no longer called by any clients
[functions.update-app-state]
verify_jwt = false

[functions.validate-device]
verify_jwt = false

[functions.webex-oauth-callback]
verify_jwt = false

[functions.webex-oauth-start]
verify_jwt = false

[functions.webex-status]
verify_jwt = false

[functions.webex-status-sweep]
verify_jwt = false

[functions.webex-token]
verify_jwt = false

[functions.approve-device]
verify_jwt = false

[functions.webex-user-login]
verify_jwt = false

[functions.webex-user-callback]
verify_jwt = false
